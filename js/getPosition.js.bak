$(function(){	

	window.onload = function(){
		window.global = new Object;
		window.global.nowSetFlag = false;
		getNowLocation();
	}

	$("#btn").on("click",function(){
		getLocation("matsue");

	});

  getLocation = function(place){
		var url = "http://maps.googleapis.com/maps/api/geocode/json?address="+place+"&sensor=true";
		console.log(url);
		$.ajax({
			url: url
		}).done(function(data){
			window.global.destLocationLat = data.results[0].geometry.location.lat;	
			window.global.destLocationLon = data.results[0].geometry.location.lng;	
			getDistance("matsue");
		}).fail(function(){
			console.log("error");
		});
	}
	getDistance = function(){
		var now_lat = window.global.nowLocationLat;
		var now_lon = window.global.nowLocationLon;
		var dest_lat = window.global.destLocationLat;
		var dest_lon = window.global.destLocationLon;
		if(!(now_lat && now_lon && dest_lat && dest_lon)){
			console.log(now_lat+"    "+now_lon+"    "+dest_lat+"    "+dest_lon);
			return "non";
		}
		var url = "http://maps.googleapis.com/maps/api/distancematrix/json?origins="+now_lat+","+now_lon+"&destinations="+dest_lat+","+dest_lon+"&language=ja&sensor=true";
		$.ajax({
			url: url
		}).done(function(data){
			console.log("distance");	
			console.log(data);	
		}).fail(function(e,txt){
			console.log(txt);	
		});
	}
});
